<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å›¾åºŠæ–‡ä»¶ç®¡ç†</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { margin-bottom: 10px; }
        ul { list-style: none; padding-left: 20px; }
        li { margin: 5px 0; }
        .dir { font-weight: bold; cursor: pointer; }
        .file { color: #555; }
    </style>
</head>
<body>

<h2>ğŸ“‚ æ–‡ä»¶æµè§ˆ</h2>
<div id="currentPath">å½“å‰è·¯å¾„: /</div>
<ul id="fileList"></ul>

<h2>ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</h2>
<form id="uploadForm">
    <input type="file" name="file" required>
    <button type="submit">ä¸Šä¼ </button>
</form>

<script>
let currentPath = "";

async function loadFiles(path = "") {
    currentPath = path;
    document.getElementById("currentPath").innerText = "å½“å‰è·¯å¾„: /" + path;
    const res = await fetch(`/list?path=${encodeURIComponent(path)}`);
    if (!res.ok) {
        alert("åŠ è½½æ–‡ä»¶å¤±è´¥");
        return;
    }
    const data = await res.json();
    const fileList = document.getElementById("fileList");
    fileList.innerHTML = "";

    // å¦‚æœä¸æ˜¯æ ¹ç›®å½•ï¼Œæ˜¾ç¤ºè¿”å›ä¸Šçº§
    if (path) {
        const li = document.createElement("li");
        li.innerHTML = `<span class="dir">â¬…ï¸ è¿”å›ä¸Šçº§</span>`;
        li.onclick = () => {
            const parent = path.split("/").slice(0, -1).join("/");
            loadFiles(parent);
        };
        fileList.appendChild(li);
    }

    data.files.forEach(item => {
        const li = document.createElement("li");
        if (item.type === "directory") {
            li.innerHTML = `<span class="dir">ğŸ“ ${item.name}</span>`;
            li.onclick = () => loadFiles(path ? `${path}/${item.name}` : item.name);
        } else {
            li.innerHTML = `<a class="file" href="/files/${path ? path + '/' : ''}${item.name}" target="_blank">ğŸ–¼ï¸ ${item.name}</a>`;
        }
        fileList.appendChild(li);
    });
}

document.getElementById("uploadForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    formData.append("targetPath", currentPath);

    const res = await fetch("/upload", {
        method: "POST",
        body: formData
    });
    if (res.ok) {
        alert("ä¸Šä¼ æˆåŠŸï¼");
        loadFiles(currentPath);
    } else {
        alert("ä¸Šä¼ å¤±è´¥");
    }
});

loadFiles();
</script>

</body>
</html>
